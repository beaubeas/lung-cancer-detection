version: "3"
services:
    mongo-config:
        # image: mongo:4.4
        image: mongo:3.6
        network_mode: host
        container_name: mongo-config-test
        ports:
          - 27000:27000
        command: --configsvr --dbpath /data/db --port 27000 --replSet replconf --bind_ip 127.0.0.1
        volumes:
        - ./mongodb/storage_config:/data/db
    mongo-instance:
        # image: mongo:4.4
        image: mongo:3.6
        network_mode: host
        container_name: mongo-instance-test
        ports:
            - 27001:27001
        command: --dbpath /data/db --port 27001 --shardsvr --replSet replmain --sslMode disabled --bind_ip 127.0.0.1
        volumes:
        - ./mongodb/storage_instance:/data/db
    glue:
        build:
            context: mongodb/glue/.
            dockerfile: Dockerfile
        image: mongo-glue-test:1.0
        network_mode: host
        container_name: mongo-glue-test
        depends_on:
            - mongo-config
            - mongo-instance
        volumes:
        - ./mongodb/glue/data:/data
    mongo-mongos:
        build:
            context: mongodb/mongos/.
            dockerfile: mongos-dockerfile
        network_mode: host
        image: mongo-mongos-test:1.0
        container_name: mongo-mongos-test
        depends_on:
            - mongo-config
            - mongo-instance
            - glue
        ports:
            - 27002:27002
        volumes:
        - ./mongodb/storage_mongos:/data/db
